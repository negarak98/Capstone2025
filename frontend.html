<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Guitar Chatbot ðŸŽ¸</title>
    <style>
      body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #f5f5f5;
      }
      header {
        background: #6200ee;
        color: white;
        padding: 15px;
        text-align: center;
        font-size: 20px;
        font-weight: bold;
      }
      #chat {
        height: 80vh;
        overflow-y: auto;
        padding: 10px;
        display: flex;
        flex-direction: column;
      }
      .message {
        max-width: 70%;
        margin: 5px 0;
        padding: 10px;
        border-radius: 15px;
      }
      .bot {
        background: #e0e0e0;
        align-self: flex-start;
      }
      .user {
        background: #6200ee;
        color: white;
        align-self: flex-end;
      }
      #input-area {
        display: flex;
        padding: 10px;
        border-top: 1px solid #ddd;
        background: white;
      }
      #input {
        flex: 1;
        padding: 10px;
        font-size: 16px;
        border: 1px solid #ccc;
        border-radius: 10px;
        outline: none;
      }
      button {
        margin-left: 10px;
        padding: 10px 15px;
        background: #6200ee;
        color: white;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        font-size: 16px;
      }
    </style>
  </head>
  <body>
    <header>Guitar Chatbot ðŸŽ¸</header>
    <div id="chat"></div>
    <div id="input-area">
      <input id="input" type="text" placeholder="Type your message..." />
      <button onclick="sendMessage()">Send</button>
    </div>

    <!-- React & Babel CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

    <!-- Our React code -->
    <script type="text/babel">
      const { useState, useEffect, useRef } = React;

      function Chatbot() {
        const [messages, setMessages] = useState([
          { sender: "bot", text: "Hello! ðŸŽ¸ How can I help you today?" }
        ]);
        const [input, setInput] = useState("");
        const chatRef = useRef(null);

        useEffect(() => {
          if (chatRef.current) {
            chatRef.current.scrollTop = chatRef.current.scrollHeight;
          }
        }, [messages]);

        const sendMessage = async () => {
          if (!input.trim()) return;

          const userMsg = { sender: "user", text: input };
          setMessages((prev) => [...prev, userMsg]);

          const lambdaUrl = "https://your-api-gateway-url.amazonaws.com/dev/chatbot"; // <-- replace with your actual URL

          try {
            const res = await fetch(lambdaUrl, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ message: input, userId: "webUser123" })
            });
            const data = await res.json();
            const botMsg = { sender: "bot", text: data.reply };
            setMessages((prev) => [...prev, botMsg]);
          } catch (error) {
            const errorMsg = { sender: "bot", text: "Oops! Something went wrong." };
            setMessages((prev) => [...prev, errorMsg]);
            console.error(error);
          }

          setInput("");
        };

        return (
          <>
            <div id="chat" ref={chatRef}>
              {messages.map((msg, idx) => (
                <div
                  key={idx}
                  className={`message ${msg.sender}`}
                >
                  {msg.text}
                </div>
              ))}
            </div>
            <div id="input-area">
              <input
                id="input"
                type="text"
                value={input}
                onChange={(e) => setInput(e.target.value)}
                onKeyDown={(e) => e.key === "Enter" && sendMessage()}
                placeholder="Type your message..."
              />
              <button onClick={sendMessage}>Send</button>
            </div>
          </>
        );
      }

      ReactDOM.render(<Chatbot />, document.body);
    </script>
  </body>
</html>
